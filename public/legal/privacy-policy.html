<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy - Naman's Hub</title>
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --primary-color: #2c3e50; /* Dark Blue */
            --secondary-color: #3498db; /* Bright Blue */
            --accent-color: #e74c3c; /* Red Accent */
            --background-color: #ecf0f1; /* Light Grey */
            --text-color: #34495e; /* Dark Grey */
            --card-background: #ffffff; /* White */
            --border-color: #bdc3c7; /* Light Silver */
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --header-font: 'Georgia', serif;
            --border-radius: 8px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --sticky-toc-offset: 130px; /* Adjust based on TOC height + top offset */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth; /* Enables smooth scrolling for anchor links */
        }

        body {
            font-family: var(--font-family);
            line-height: 1.7;
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Layout & Container --- */
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: var(--card-background);
            padding: 30px 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            flex-grow: 1; /* Make container grow to fill space */
        }

        /* --- Header --- */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .header h1 {
            font-family: var(--header-font);
            color: var(--primary-color);
            font-size: 2.8em;
            margin-bottom: 5px;
        }

        .header h2 {
            color: var(--secondary-color);
            font-size: 1.8em;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .last-updated {
            font-size: 0.9em;
            color: #7f8c8d; /* Medium Grey */
        }

        /* --- Table of Contents (TOC) --- */
        #toc-container {
            background-color: #f8f9f9;
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--secondary-color);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
            transition: all var(--transition-speed) ease;
            /* Sticky properties applied conditionally via media query */
        }

        #toc-container h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.3em;
        }

        #toc-list {
            list-style: none;
            padding-left: 0;
        }

        #toc-list li a {
            text-decoration: none;
            color: var(--secondary-color);
            display: block;
            padding: 5px 0;
            transition: color var(--transition-speed), padding-left var(--transition-speed), background-color var(--transition-speed);
            border-bottom: 1px dashed var(--border-color);
        }
        #toc-list li:last-child a {
             border-bottom: none;
        }

        #toc-list li a:hover,
        #toc-list li a:focus {
            color: var(--accent-color);
            padding-left: 10px;
            background-color: #eaf2f8; /* Light blue on hover */
        }
        #toc-list li a.active { /* Style for the active TOC link */
             color: var(--accent-color);
             font-weight: bold;
             padding-left: 10px;
             background-color: #eaf2f8;
             border-left: 3px solid var(--accent-color);
        }


        /* --- Main Content Sections --- */
        .content-section {
            margin-bottom: 35px;
            padding-top: 20px; /* Standard padding for visual spacing within section */
            /* scroll-margin-top applied conditionally below */
        }

        .content-section h3 {
            font-family: var(--header-font);
            color: var(--primary-color);
            font-size: 1.6em;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }

         .content-section h4 {
            color: var(--secondary-color);
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .content-section p,
        .content-section ul,
        .content-section ol {
            margin-bottom: 15px;
        }

        .content-section ul,
        .content-section ol {
            margin-left: 25px;
        }

        .content-section li {
            margin-bottom: 8px;
        }

        /* --- Emphasis & Links --- */
        strong {
            color: var(--primary-color);
        }

        a {
            color: var(--secondary-color);
            text-decoration: none;
            transition: color var(--transition-speed);
        }

        a:hover, a:focus {
            color: var(--accent-color);
            text-decoration: underline;
        }

        /* --- Important Notice Box --- */
        .notice {
            background-color: #fdf3e6; /* Light Orange */
            border: 1px solid #f5cba7; /* Orange Border */
            border-left: 5px solid var(--accent-color);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: var(--border-radius);
        }
        .notice strong {
            color: var(--accent-color);
        }

        /* --- Action Buttons (Only Print Button Here) --- */
        .actions-container {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            display: flex;
            justify-content: center; /* Center the single button */
            align-items: center;
            gap: 15px;
        }

        .action-button {
            background-color: var(--accent-color); /* Using accent for print */
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .action-button:hover:not(:disabled) {
            background-color: #c0392b; /* Darker Red */
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* --- Footer --- */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .footer a {
            color: var(--primary-color);
        }
        .footer a:hover {
            color: var(--accent-color);
        }


        /* --- Responsive Design --- */

        /* Styles for when TOC is sticky (Larger Screens) */
        @media (min-width: 769px) {
             .content-section {
                scroll-margin-top: var(--sticky-toc-offset);
             }
             #toc-container {
                 position: sticky;
                 top: 20px;
                 max-height: calc(100vh - 40px);
                 overflow-y: auto;
                 z-index: 10;
             }
             .actions-container {
                 justify-content: flex-end; /* Align button to the right on larger screens */
             }
        }

        /* Styles for Small/Medium Screens (TOC is not sticky) */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                margin: 10px auto;
            }
            .header h1 {
                font-size: 2.2em;
            }
             .header h2 {
                font-size: 1.5em;
            }
            #toc-container {
                position: static;
                max-height: none;
                margin-bottom: 25px;
                z-index: auto;
                overflow-y: visible;
            }
             .content-section {
                 scroll-margin-top: 0;
             }
             .content-section h3 {
                font-size: 1.4em;
            }
             .content-section h4 {
                font-size: 1.1em;
            }
            .actions-container {
                 justify-content: center; /* Keep centered on medium screens */
            }
             .action-button {
                 width: 60%; /* Adjust width as needed */
             }
        }

        /* Further adjustments for very small screens */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
             .header h2 {
                font-size: 1.3em;
            }
            .container {
                padding: 15px;
            }
            body {
                font-size: 15px;
            }
             .action-button {
                width: 90%;
                padding: 10px 20px;
             }
        }

        /* Print specific styles */
        @media print {
          body {
            padding: 0;
            background-color: #fff;
            color: #000;
            font-size: 12pt;
          }
          .container {
            box-shadow: none;
            border: none;
            padding: 0;
            margin: 0;
            max-width: 100%;
          }
          #toc-container, .actions-container, .footer {
            display: none; /* Hide TOC, buttons, and footer when printing */
          }
          .header {
             border-bottom: 1px solid #ccc;
             text-align: left;
          }
           .header h1, .header h2 {
                color: #000;
           }
           .content-section {
             padding-top: 10px;
             margin-top: 0;
             margin-bottom: 20px;
             scroll-margin-top: 0 !important;
           }
           .content-section h3 {
             border-bottom: 1px solid #666;
             color: #000;
             font-size: 1.3em;
             page-break-after: avoid;
           }
           a {
             color: #000;
             text-decoration: none;
           }
            a[href^="http"]::after { /* Show URLs for external links in print */
                content: " (" attr(href) ")";
                font-size: 90%;
                color: #555;
            }
           .notice {
              border: 1px solid #aaa;
              background-color: #eee;
              border-left: 3px solid #666;
              color: #000;
           }
            .notice strong {
               color: #000;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>Naman's Hub</h1>
            <h2>Privacy Policy</h2>
            <p class="last-updated">Last Updated: April 2, 2025</p> <!-- *** IMPORTANT: UPDATE THIS DATE *** -->
        </header>

        <main>
            <section class="content-section" id="introduction">
                <h3>1. Introduction</h3>
                <p>Welcome to Naman's Hub ("we," "us," or "our"). We are committed to protecting your personal information and your right to privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website and use our services (collectively, the "Service").</p>
                <p>Please read this privacy policy carefully. If you do not agree with the terms of this privacy policy, please do not access or use the Service.</p>
                <p>This Privacy Policy applies to all information collected through our Service and any related services, sales, marketing, or events. It should be read in conjunction with our <a href="./tos.html">Terms of Service</a>.</p> <!-- Update link if necessary -->
                <div class="notice">
                    <strong>Legal Disclaimer:</strong> This 'Privacy Policy' may or may not meet the requirements of laws like GDPR, CCPA, etc., as it is not an official registered company and non-profit website. So we can't ensure expected data processing activities according to international laws.
                </div>
            </section>

            <section class="content-section" id="data-collected">
                <h3>2. Information We Collect</h3>
                <p>We collect personal information that you voluntarily provide to us when you register on the Service, express an interest in obtaining information about us or our products and services, when you participate in activities on the Service (such as submitting research papers, posting comments), or otherwise when you contact us.</p>
                <p>The personal information that we collect depends on the context of your interactions with us and the Service, the choices you make, and the products and features you use. The personal information we collect may include the following:</p>
                <ul>
                    <li><strong>Personal Identification Information:</strong> Name, email address, affiliation (e.g., university, institution), ORCID ID (if provided), username, password, and other similar contact data.</li>
                    <li><strong>User Content:</strong> Research papers, articles, abstracts, datasets, comments, reviews, profile information (like research interests, publications list), and any other content you submit or post on the Service.</li>
                    <li><strong>Usage Data:</strong> Information about how you access and use the Service, such as your IP address, browser type, operating system, referring URLs, device information, pages viewed, time spent on pages, links clicked, and search queries.</li>
                    <li><strong>Cookies and Tracking Technologies:</strong> We use cookies and similar tracking technologies (like web beacons and pixels) to access or store information. Specific information about how we use such technologies and how you can refuse certain cookies is set out in our Cookie Policy section below (Section 5).</li>
                </ul>
                 <p>We do not intentionally collect sensitive personal information (e.g., social security numbers, information related to racial or ethnic origin, political opinions, religion or other beliefs, health, biometrics or genetic characteristics, criminal background) unless required for a specific, disclosed purpose and with explicit consent or as permitted by law.</p>
            </section>

            <section class="content-section" id="how-data-used">
                <h3>3. How We Use Your Information</h3>
                <p>We use personal information collected via our Service for a variety of business purposes described below:</p>
                <ul>
                    <li><strong>To Provide and Manage the Service:</strong> To create and manage your account, facilitate the submission and publication of research papers, enable user interaction (comments, discussions), and provide customer support.</li>
                    <li><strong>To Personalize User Experience:</strong> To understand how users interact with the Service and personalize content and recommendations.</li>
                    <li><strong>To Communicate with You:</strong> To send you administrative information (e.g., updates to terms, policies), respond to your inquiries, and provide service-related notifications (e.g., submission status, review requests). We may also send marketing communications if you opt-in.</li>
                    <li><strong>To Improve Our Service:</strong> To analyze usage trends, gather feedback, and improve the functionality, features, and security of the Service.</li>
                    <li><strong>For Research and Analytics:</strong> To perform research and analysis on an aggregated or de-identified basis about academic trends, usage patterns, and the impact of research shared on the platform.</li>
                    <li><strong>To Enforce Terms and Policies:</strong> To ensure compliance with our Terms of Service and other policies, and to detect and prevent fraud, plagiarism, or other prohibited activities.</li>
                    <li><strong>For Legal Obligations:</strong> To comply with applicable laws, regulations, legal processes, or governmental requests.</li>
                </ul>
            </section>

             <section class="content-section" id="how-data-shared">
                <h3>4. How We Share Your Information</h3>
                <p>We may process or share your data that we hold based on the following legal basis and circumstances:</p>
                <ul>
                    <li><strong>Consent:</strong> We may share your information if you have given us specific consent to use your personal information for a specific purpose.</li>
                    <li><strong>Performance of a Contract:</strong> Where we have entered into a contract with you (like our Terms of Service), we may process your personal information to fulfill the terms of our contract.</li>
                    <li><strong>Legitimate Interests:</strong> We may process your data when it is reasonably necessary to achieve our legitimate business interests, provided those interests are not overridden by your interests and fundamental rights and freedoms.</li>
                    <li><strong>Legal Obligations:</strong> We may disclose your information where we are legally required to do so in order to comply with applicable law, governmental requests, a judicial proceeding, court order, or legal process.</li>
                    <li><strong>Vital Interests:</strong> We may disclose your information where we believe it is necessary to investigate, prevent, or take action regarding potential violations of our policies, suspected fraud, situations involving potential threats to the safety of any person and illegal activities, or as evidence in litigation in which we are involved.</li>
                </ul>
                <p>More specifically, we may need to share your personal information in the following situations:</p>
                <ul>
                    <li><strong>With Other Users:</strong> Information you choose to make public, such as your profile information, submitted research papers (based on visibility settings, if applicable), and comments, will be accessible to other users of the Service.</li>
                    <li><strong>Service Providers:</strong> We may share your data with third-party vendors, service providers, contractors, or agents who perform services for us or on our behalf and require access to such information to do that work (e.g., cloud hosting, data analysis, email delivery, customer service, plagiarism detection services). We require these third parties to maintain the confidentiality of your information and use it only for the purposes for which we disclose it to them. Example: Vercel for hosting, MySQL for database, Github for repository, Vistual Studio Code for IDE, Google Analytics for analytics, and AI for improvements.</li>
                    <li><strong>Business Transfers:</strong> We may share or transfer your information in connection with, or during negotiations of, any merger, sale of company assets, financing, or acquisition of all or a portion of our business to another company.</li>
                    <li><strong>Aggregated/De-identified Data:</strong> We may share aggregated or de-identified information (which does not directly identify you) for research, analysis, or reporting purposes.</li>
                 </ul>
                 <div class="notice">
                    <strong>Your Research Papers:</strong> By submitting Research Papers, you understand they may become publicly accessible depending on the platform's features and potential indexing by search engines, as outlined in our Terms of Service. You retain copyright but grant us a license to display them.
                </div>
            </section>

            <section class="content-section" id="cookies">
                <h3>5. Cookies and Tracking Technologies</h3>
                <p>We use cookies and similar tracking technologies (like web beacons, pixels, and log files) to collect and use personal information about you, including to understand usage patterns and potentially serve interest-based advertising (if applicable).</p>
                <ul>
                    <li><strong>What are Cookies?</strong> Cookies are small data files stored on your browser or device. They may be session cookies (deleted when you close your browser) or persistent cookies (remain until deleted or expired).</li>
                    <li><strong>How We Use Them:</strong> We use cookies for essential functions (like keeping you logged in), performance analysis (understanding how the site is used), functionality (remembering your preferences), and potentially for targeting/advertising (if applicable).</li>
                    <li><strong>Your Choices:</strong> Most web browsers are set to accept cookies by default. You can usually choose to set your browser to remove cookies and to reject cookies. If you choose to remove or reject cookies, this could affect certain features or services of our Service. For more information, please see your browser's help documentation.</li>
                </ul>
            </section>

             <section class="content-section" id="data-security">
                <h3>6. How We Protect Your Information</h3>
                <p>We have implemented appropriate technical and organizational security measures designed to protect the security of any personal information we process. </p>
                <p>However, despite our safeguards and efforts to secure your information, no electronic transmission over the Internet or information storage technology can be guaranteed to be 100% secure. Therefore, we cannot promise or guarantee that hackers, cybercriminals, or other unauthorized third parties will not be able to defeat our security and improperly collect, access, steal, or modify your information. Although we will do our best to protect your personal information, transmission of personal information to and from our Service is at your own risk. You should only access the Service within a secure environment.</p>
            </section>

            <section class="content-section" id="data-retention">
                <h3>7. How Long We Keep Your Information</h3>
                <p>We will only keep your personal information for as long as it is necessary for the purposes set out in this privacy policy, unless a longer retention period is required or permitted by law (such as tax, accounting, or other legal requirements). Typically, this means we retain your account information for as long as your account is active.</p>
                <p>User Content, such as published research papers, may be retained indefinitely as part of the academic record on the platform, even after account deletion, unless you specifically request its removal and such removal is feasible and permitted under our Terms and policies.</p>
                <p>When we have no ongoing legitimate business need to process your personal information, we will either delete or anonymize such information, or, if this is not possible (for example, because your personal information has been stored in backup archives), then we will securely store your personal information and isolate it from any further processing until deletion is possible.</p>
            </section>

             <section class="content-section" id="user-rights">
                <h3>8. Your Privacy Rights</h3>
                <p>Depending on your location (e.g., if you are in the European Economic Area (EEA), UK, California), you may have certain rights regarding your personal information under applicable data protection laws. These may include the right to:</p>
                <ul>
                    <li><strong>Access:</strong> Request access to and obtain a copy of your personal information.</li>
                    <li><strong>Rectification:</strong> Request correction of inaccurate or incomplete personal information.</li>
                    <li><strong>Erasure:</strong> Request the deletion of your personal information ('right to be forgotten').</li>
                    <li><strong>Restrict Processing:</strong> Request the restriction of processing of your personal information.</li>
                    <li><strong>Data Portability:</strong> Request to receive your personal information in a structured, commonly used, and machine-readable format.</li>
                    <li><strong>Object to Processing:</strong> Object to the processing of your personal information based on legitimate interests or for direct marketing purposes.</li>
                    <li><strong>Withdraw Consent:</strong> Withdraw your consent at any time where we are relying on consent to process your personal information.</li>
                 </ul>
                 <p>To exercise these rights, please contact us using the contact details provided below (Section 13). We will respond to your request in accordanceance with applicable data protection laws.</p>
                 <p>You may also be able to review and update some of your personal information directly through your account settings page.</p>
                 <h4>Account Information</h4>
                 <p>You may at any time review or change the information in your account or terminate your account by logging into your account settings and updating your account, or by contacting us using the contact information provided. Upon your request to terminate your account, we will deactivate or delete your account and information from our active databases. However, we may retain some information in our files to prevent fraud, troubleshoot problems, assist with any investigations, enforce our Terms of Service and/or comply with legal requirements.</p>
            </section>

             <section class="content-section" id="childrens-privacy">
                <h3>9. Children's Privacy</h3>
                <p>Our Service is not directed to individuals under the age of 16, and we do not knowingly collect personal information from children under this age. If we become aware that we have inadvertently collected personal information from a child under the applicable age limit without verification of parental consent, we will take steps to delete such information as soon as possible. If you believe we might have any information from or about a child under the applicable age limit, please contact us.</p>
            </section>

            <section class="content-section" id="international-transfers">
                <h3>10. International Data Transfers</h3>
                <p>Your information, including personal information, may be transferred to — and maintained on — computers located outside of your state, province, country, or other governmental jurisdiction where the data protection laws may differ from those in your jurisdiction.</p>
                <p>If you are located outside Nepal and choose to provide information to us, please note that we transfer the data, including personal information, to Nepal and process it there.</p>
                <p>We will take all steps reasonably necessary to ensure that your data is treated securely and in accordance with this privacy policy and applicable law. </p>
            </section>

            <section class="content-section" id="third-party-links">
                <h3>11. Links to Other Websites</h3>
                <p>The Service may contain links to other websites not operated or controlled by us ("Third-Party Websites"). The policies and procedures we described here do not apply to Third-Party Websites. The links from the Service do not imply that we endorse or have reviewed the Third-Party Websites. We suggest contacting those sites directly for information on their privacy policies.</p>
            </section>

            <section class="content-section" id="policy-changes">
                <h3>12. Changes to This Privacy Policy</h3>
                <p>We may update this privacy policy from time to time. The updated version will be indicated by an updated "Last Updated" date and the updated version will be effective as soon as it is accessible. If we make material changes to this privacy policy, we may notify you either by prominently posting a notice of such changes or by directly sending you a notification. We encourage you to review this privacy policy frequently to be informed of how we are protecting your information.</p>
            </section>

            <section class="content-section" id="contact">
                <h3>13. Contact Us</h3>
                <p>If you have questions or comments about this Privacy Policy, or if you wish to exercise your privacy rights, please contact us at:</p>
                <p>
                    Naman's Hub<br>
                    Attn: Privacy Officer<br>
                    example@example.com<br>
                    Nepal
                </p>
            </section>

        </main>

        <!-- Actions -->
        <div class="actions-container">
             <button id="print-policy-button" class="action-button">Print Policy</button>
        </div>

        <footer class="footer">
            <p>© <span id="current-year"></span> Naman's Hub. All rights reserved.</p>
            <p><a href="./tos.html">Terms of Service</a> | <a href="../resources/submit-paper.html">Contact Us</a></p> <!-- Update links -->
        </footer>

    </div> <!-- /container -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tocList = document.getElementById('toc-list');
            const sections = document.querySelectorAll('.content-section');
            const printButton = document.getElementById('print-policy-button'); // Updated ID
            const tocContainer = document.getElementById('toc-container');

            // --- Populate Table of Contents ---
            sections.forEach(section => {
                const titleElement = section.querySelector('h3');
                if (titleElement && section.id) {
                    const titleText = titleElement.textContent;
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `#${section.id}`;
                    link.textContent = titleText;
                    listItem.appendChild(link);
                    tocList.appendChild(listItem);
                }
            });

            // --- Print Button Functionality ---
            printButton.addEventListener('click', function() {
                window.print();
            });

            // --- Dynamic Footer Year ---
            document.getElementById('current-year').textContent = new Date().getFullYear();


            // --- TOC Active Link Highlighting on Scroll ---
            const tocLinks = tocList.querySelectorAll('a');
            const stickyOffsetValue = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sticky-toc-offset'), 10) || 130;
            const topMargin = -(stickyOffsetValue) + 10;
            const bottomMargin = -(window.innerHeight - stickyOffsetValue - 100);

            const sectionObserverOptions = {
              root: null,
              rootMargin: `${topMargin}px 0px ${bottomMargin}px 0px`,
              threshold: 0
            };

            let currentlyActiveLink = null;

            const highlightCurrentSection = (entries, observer) => {
              entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                const link = tocList.querySelector(`a[href="#${id}"]`);
                if (!link) return;

                 if (entry.isIntersecting && entry.intersectionRatio > 0) {
                     const rect = entry.boundingClientRect;
                     if (rect.top >= 0 && rect.top < (stickyOffsetValue + 50)) {
                         if (currentlyActiveLink) {
                             currentlyActiveLink.classList.remove('active');
                         }
                         link.classList.add('active');
                         currentlyActiveLink = link;
                         // Optional: Scroll TOC if needed
                         // link.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                     }
                 } else {
                     if (link === currentlyActiveLink) {
                          link.classList.remove('active');
                          currentlyActiveLink = null;
                     }
                 }
              });

                // Fallback logic if nothing is active
                if (!currentlyActiveLink) {
                    let firstVisibleSection = null;
                    for (const section of sections) {
                        const rect = section.getBoundingClientRect();
                        if (rect.top >= stickyOffsetValue && rect.top < window.innerHeight * 0.8) {
                            firstVisibleSection = section;
                            break;
                        }
                    }
                    if(firstVisibleSection){
                         const id = firstVisibleSection.getAttribute('id');
                         const link = tocList.querySelector(`a[href="#${id}"]`);
                         if(link){
                            link.classList.add('active');
                            currentlyActiveLink = link;
                         }
                    } else if (window.scrollY < 100 && tocLinks.length > 0) {
                         tocLinks.forEach(l => l.classList.remove('active'));
                         tocLinks[0].classList.add('active');
                         currentlyActiveLink = tocLinks[0];
                    }
                }
            };

            if ('IntersectionObserver' in window) {
                 const observer = new IntersectionObserver(highlightCurrentSection, sectionObserverOptions);
                 sections.forEach(section => {
                     observer.observe(section);
                 });
            } else {
                console.warn("IntersectionObserver not supported, TOC highlighting might not work correctly.");
            }

             // Initial check on load
             setTimeout(() => {
                 let firstVisibleSection = null;
                 let minTop = Infinity;

                 sections.forEach(section => {
                     const rect = section.getBoundingClientRect();
                     if (rect.top >= 0 && rect.top < minTop) {
                         if (rect.top >= (stickyOffsetValue - 20)) {
                             minTop = rect.top;
                             firstVisibleSection = section;
                         } else if (window.scrollY < 100 && rect.top < stickyOffsetValue) {
                             minTop = rect.top;
                             firstVisibleSection = section;
                         }
                     }
                 });

                 if (firstVisibleSection) {
                     const id = firstVisibleSection.getAttribute('id');
                     const link = tocList.querySelector(`a[href="#${id}"]`);
                     tocLinks.forEach(l => l.classList.remove('active'));
                     if (link) {
                         link.classList.add('active');
                         currentlyActiveLink = link;
                     }
                 } else if (window.scrollY < 100 && tocLinks.length > 0) {
                      tocLinks.forEach(l => l.classList.remove('active'));
                      tocLinks[0].classList.add('active');
                      currentlyActiveLink = tocLinks[0];
                 }
             }, 150);

        });
    </script>

</body>
</html>